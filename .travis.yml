os: linux
dist: xenial

language: generic

cache:
  directories:
    - $HOME/.opam

env:
  - OCAML_VERSION=4.07
  - OCAML_VERSION=4.09
  - OCAML_VERSION=4.09 INSTALL_LOCAL=1
  - OCAML_VERSION=4.11.0+trunk OCAML_BETA=enable
    
install:
  - sudo apt-get install -y autoconf autotools-dev libtool pkg-config libffi-dev
  - test -e .travis-ocaml.sh || wget https://raw.githubusercontent.com/ocaml/ocaml-ci-scripts/master/.travis-ocaml.sh
  - bash -ex .travis-ocaml.sh

script:
  - opam pin -y -v -t add .
  - LD_LIBRARY_PATH=$(opam var libdash:lib) opam exec -- make -C test test
  - opam uninstall libdash # clear the cache

